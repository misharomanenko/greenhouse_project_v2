'use strict';

Object.defineProperty(exports, '__esModule', { value: true });

var headless = require('@stytch/vanilla-js/headless');

const cannotInvokeMethodOnServerError = (path) => `[Stytch] Invalid serverside function call to ${path}.
The Stytch Javascript SDK is intended to ony be used on the client side.
Make sure to wrap your API calls in a hook to ensure they are executed on the client.
\`\`\`
const myComponent = () => {
  const stytch = useStytch();
  // This will error out on the server.
  stytch.magicLinks.authenticate(...);
  useEffect(() => {
    // This will work well
    stytch.magicLinks.authenticate(...);
  }, []);
}
\`\`\`

If you want to make API calls from server environments, please use the Stytch Node Library
https://www.npmjs.com/package/stytch.
`;

const SSRStubKey = Symbol('__stytch_SSRStubKey');
// eslint-disable-next-line @typescript-eslint/no-explicit-any
const createProxy = (path) => {
    // eslint-disable-next-line @typescript-eslint/no-empty-function
    const noop = () => { };
    return new Proxy(noop, {
        get(target, p) {
            if (p === SSRStubKey) {
                return true;
            }
            return createProxy(path + '.' + String(p));
        },
        apply() {
            throw new Error(cannotInvokeMethodOnServerError(path));
        },
    });
};
const createStytchSSRProxy = () => createProxy('stytch');

/**
 * Creates a Headless Stytch client object to call the stytch APIs.
 * The Stytch client is not available serverside.
 * @example
 * const stytch = createStytchHeadlessClient('public-token-<find yours in the stytch dashboard>')
 *
 * return (
 *   <StytchProvider stytch={stytch}>
 *     <App />
 *   </StytchProvider>
 * )
 * @returns A {@link StytchHeadlessClient}
 */
const createStytchHeadlessClient = (...args) => {
    if (typeof window === 'undefined') {
        return createStytchSSRProxy();
    }
    return new headless.StytchHeadlessClient(...args);
};

exports.createStytchHeadlessClient = createStytchHeadlessClient;
